Version 4
SHEET 1 1364 1064
WIRE 352 -720 224 -720
WIRE 480 -720 352 -720
WIRE 352 -688 352 -720
WIRE 480 -624 480 -720
WIRE 352 -592 352 -624
WIRE 832 -560 736 -560
WIRE 960 -560 912 -560
WIRE 1152 -560 1040 -560
WIRE 1152 -512 1152 -560
WIRE 352 -496 352 -528
WIRE 480 -432 480 -544
WIRE 736 -400 736 -560
WIRE 1024 -400 736 -400
WIRE -1024 -384 -1056 -384
WIRE -928 -384 -960 -384
WIRE -784 -384 -848 -384
WIRE 352 -384 352 -432
WIRE 416 -384 352 -384
WIRE 352 -336 352 -384
WIRE 1152 -336 1152 -432
WIRE 736 -320 736 -400
WIRE 1024 -304 1024 -400
WIRE -1056 -272 -1056 -384
WIRE -1056 -272 -1088 -272
WIRE -960 -272 -1056 -272
WIRE -784 -272 -784 -384
WIRE -784 -272 -880 -272
WIRE -768 -272 -784 -272
WIRE -624 -272 -768 -272
WIRE -480 -272 -544 -272
WIRE 96 -272 32 -272
WIRE 240 -272 160 -272
WIRE 480 -240 480 -336
WIRE 688 -240 480 -240
WIRE 352 -208 352 -256
WIRE 1024 -176 1024 -224
WIRE -576 -144 -576 -160
WIRE 480 -144 480 -240
WIRE 736 -144 736 -224
WIRE 832 -144 736 -144
WIRE -768 -128 -768 -272
WIRE -608 -128 -768 -128
WIRE 128 -128 128 -144
WIRE -480 -112 -480 -272
WIRE -480 -112 -544 -112
WIRE -384 -112 -384 -160
WIRE -384 -112 -480 -112
WIRE -368 -112 -384 -112
WIRE -256 -112 -256 -160
WIRE -256 -112 -288 -112
WIRE -160 -112 -256 -112
WIRE 32 -112 32 -272
WIRE 32 -112 -80 -112
WIRE 96 -112 32 -112
WIRE 736 -112 736 -144
WIRE -1056 -96 -1088 -96
WIRE -960 -96 -1056 -96
WIRE -784 -96 -880 -96
WIRE -704 -96 -784 -96
WIRE -608 -96 -704 -96
WIRE 240 -96 240 -272
WIRE 240 -96 160 -96
WIRE 288 -96 288 -144
WIRE 288 -96 240 -96
WIRE 416 -96 288 -96
WIRE 32 -80 -32 -80
WIRE 96 -80 32 -80
WIRE -576 -64 -576 -80
WIRE 128 -48 128 -64
WIRE -704 -32 -704 -96
WIRE 32 -32 32 -80
WIRE -160 16 -224 16
WIRE -32 16 -32 -80
WIRE -32 16 -80 16
WIRE 736 16 736 -32
WIRE 832 16 736 16
WIRE -1056 32 -1056 -96
WIRE -1024 32 -1056 32
WIRE -928 32 -960 32
WIRE -784 32 -784 -96
WIRE -784 32 -848 32
WIRE 736 48 736 16
WIRE 32 96 32 32
WIRE -704 160 -704 48
WIRE 480 160 480 -48
WIRE 736 160 736 128
WIRE 1024 160 1024 -112
WIRE -1056 448 -1056 384
WIRE -1056 560 -1056 528
WIRE -1408 672 -1408 624
WIRE -1280 672 -1280 544
WIRE -1056 672 -1056 640
WIRE -1408 800 -1408 752
WIRE -1408 800 -1504 800
WIRE -1280 800 -1280 752
WIRE -1280 800 -1408 800
WIRE -1056 800 -1056 752
WIRE -1056 800 -1280 800
WIRE -1504 832 -1504 800
WIRE -1408 864 -1408 800
WIRE -1408 992 -1408 944
FLAG -1504 832 0
FLAG -1408 624 V+
FLAG -1408 992 V-
FLAG 736 160 0
FLAG 832 -144 Isense_hi1
FLAG 480 160 0
FLAG 224 -720 V+
FLAG 128 -144 V+
FLAG 128 -48 V-
FLAG 1152 -336 0
FLAG 1024 160 0
FLAG 352 -208 0
FLAG -576 -160 V+
FLAG -576 -64 V-
FLAG -1088 -272 Isense_lo1
FLAG -384 -160 A1
FLAG -256 -160 B1
FLAG 832 16 Isense_lo1
FLAG -1088 -96 Isense_hi1
FLAG -704 160 0
FLAG -1280 544 Vset_ac
FLAG -224 16 Vset_tran
FLAG -1056 384 Vset_tran
FLAG 288 -144 C1
FLAG 32 96 0
SYMBOL voltage -1408 656 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V1
SYMATTR Value 15
SYMBOL voltage -1408 848 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V2
SYMATTR Value 15
SYMBOL voltage -1056 656 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V3
SYMATTR Value PULSE(0 {Iset/setgain1} {0.1/freq} {0.3/freq} {0.3/freq} {0.2/freq} {2/freq} 1)
SYMBOL nmos 688 -320 R0
SYMATTR InstName M1
SYMATTR Value IRFP250N
SYMBOL res 720 -128 R0
SYMATTR InstName Rsense1
SYMATTR Value {1/(setgain1*sensegain1)}
SYMBOL pnp 416 -48 M180
SYMATTR InstName Q1
SYMATTR Value 2N2907
SYMBOL pnp 416 -336 M180
SYMATTR InstName Q2
SYMATTR Value 2N2907
SYMBOL cap 160 -288 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value {Cea_c}
SYMBOL diode 336 -688 R0
SYMATTR InstName D1
SYMATTR Value 1N4148
SYMBOL diode 336 -592 R0
SYMATTR InstName D2
SYMATTR Value 1N4148
SYMBOL diode 336 -496 R0
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL res 464 -640 R0
SYMATTR InstName R14
SYMATTR Value 120
SYMBOL ind 928 -576 R90
WINDOW 0 5 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Lload1
SYMATTR Value 3.3µ
SYMBOL res 1056 -576 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rload1
SYMATTR Value 0.1
SYMBOL voltage 1152 -528 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName Vload1
SYMATTR Value 20
SYMBOL cap 1008 -176 R0
SYMATTR InstName C3
SYMATTR Value 2.2µ
SYMBOL res 336 -352 R0
SYMATTR InstName R6
SYMATTR Value 2.7k
SYMBOL res 1008 -320 R0
SYMATTR InstName R7
SYMATTR Value 2.2
SYMBOL res -64 -128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value {Rser1}
SYMBOL res -64 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value {Rser1}
SYMBOL cap -960 -400 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value {Ccsa_c}
SYMBOL res -832 -400 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value {Rcsa_c}
SYMBOL res -976 -288 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value {Rcsa1}
SYMBOL res -640 -288 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value {Rcsa1*sensegain1}
SYMBOL res 720 32 R0
SYMATTR InstName R8
SYMATTR Value 0.05
SYMBOL res -976 -112 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value {Rcsa1}
SYMBOL cap -960 16 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value {Ccsa_c}
SYMBOL res -832 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value {Rcsa_c}
SYMBOL res -720 -48 R0
SYMATTR InstName Rsense2
SYMATTR Value {Rcsa1*sensegain1}
SYMBOL voltage -1056 544 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V4
SYMATTR Value PULSE(0 {Iset/setgain1} {1.25/freq} {10m/freq} {10m/freq} {0.5/freq} {2/freq} 1)
SYMBOL voltage -1056 432 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V5
SYMATTR Value SINE({Iset/setgain1/2} {Iset/setgain1/2} {freq} {2/freq} 0 270)
SYMBOL voltage -1280 656 R0
WINDOW 123 0 0 Left 2
WINDOW 39 0 0 Left 2
SYMATTR InstName V6
SYMATTR Value {Iset/setgain1}
SYMBOL voltage -272 -112 R90
WINDOW 123 24 44 Left 2
WINDOW 39 0 0 Left 2
SYMATTR Value2 AC 1
SYMATTR InstName V8
SYMATTR Value 0
SYMBOL Opamps\\TL072 -576 -176 R0
SYMATTR InstName U1
SYMBOL Opamps\\TL072 128 -160 R0
SYMATTR InstName U2
SYMBOL cap 16 -32 R0
SYMATTR InstName C5
SYMATTR Value {Cea_c}
TEXT -736 256 Left 2 ;current sense amplifier
TEXT 32 256 Left 2 ;error amplifier
TEXT 480 256 Left 2 ;driver
TEXT 736 256 Left 2 ;series pass element
TEXT 368 -248 Left 2 ;~ 5mA
TEXT 496 -536 Left 2 ;~ 10mA
TEXT -32 608 Left 2 !.PARAM setgain1 2
TEXT 288 672 Left 2 !;.STEP PARAM sensegain1 LIST 10 20 50 100
TEXT -32 832 Left 2 !.PARAM Rcsa1 1k
TEXT -32 384 Left 2 ;.AC OCT 10 100 1MEG
TEXT 288 640 Left 2 !;.STEP PARAM Iset LIST 10u 100u 1m 10m 100m
TEXT -32 640 Left 2 !.PARAM Iset 5
TEXT -32 512 Left 2 !.MEAS AC ph_min MIN(Ph(V(a1)/V(b1))) TARG Mag(V(a1)/V(b1))=1 FALL=1
TEXT -32 736 Left 2 !.PARAM Ccsa_c 220p
TEXT -32 800 Left 2 !.PARAM Cea_c 470p
TEXT -32 768 Left 2 !.PARAM Rcsa_c 0.1
TEXT -32 672 Left 2 !.PARAM sensegain1 10
TEXT 288 736 Left 2 !;.STEP PARAM Ccsa_c LIST 0.1p 100p 150p 220p 330p 470p 680p 1n 1.5n 2.2n
TEXT 288 768 Left 2 !;.STEP PARAM Rcsa_c LIST 0.1 100 150 220 330 470 680 1k
TEXT -32 864 Left 2 !.PARAM Rser1 10k
TEXT 288 800 Left 2 !;.STEP PARAM Cea_c LIST 0.1p 100p 150p 220p 330p 470p 680p 1n 1.5n 2.2n
TEXT -32 544 Left 2 !.OPTIONS meascplxfmt=polar
TEXT -32 448 Left 2 !.PARAM freq 10k
TEXT -32 416 Left 2 !.TRAN {3/freq}
TEXT -32 352 Left 2 ;.TRAN {3/freq}
TEXT 288 608 Left 2 !;.STEP PARAM setgain1 LIST 0.1 0.5 1 2
TEXT 288 448 Left 2 !;.STEP PARAM freq LIST 100 1k 10k
